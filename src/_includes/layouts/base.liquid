<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <title>flo</title>

        <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">

        <link href="/assets/css/reset.css" rel="stylesheet">
        <link href="/assets/css/style.css" rel="stylesheet">
    </head>

  <body>
    <main class="l-container">
        <nav class="c-navbar">
          <div class="c-navbar__wrapper">
            <div class="c-navbar__left">
              <h2><a href="/">flo</a></h2>
            </div>
            <div class="c-navbar__center">
              <ul>
                <li><a href="#features">Features</a></li>
                <li><a href="#faq">FAQ</a></li>
                <li><a target="_blank" rel="noopener noreferer" href="https://github.com/kepelet/flo">Source Code</a></li>
                <li><a target="_blank" rel="noopener noreferer" href="https://github.com/orgs/kepelet/projects/1/views/1">Roadmap</a></li>
              </ul>
            </div>
            <div class="c-navbar__right">
              <button class="c-button c-button--cta-navbar" id="openModal">Join the waitlist</button>
            </div>
          </div>
        </nav>
        {{ content }}
        <div class="js-modal" id="modal">
            <div class="js-modal__content">
                <span class="js-modal__close" id="closeModal">&times;</span>
                <h2>Join the waitlist</h2>
                <p>Currently flo is in early preview and we'll let you know when we're on the App Store.</p>
                <input id="email" type="email" placeholder="john@doe.com" required>
                <div class="cf-turnstile" data-callback="enableSubmit" data-sitekey="0x4AAAAAAAi7bs0DROJL1xPi" data-size="flexible"></div>
                <button id="submit" disabled>Submit</button>
            </div>
        </div>

        <script>
        const modal = document.getElementById('modal')
        const openModal = document.getElementById('openModal')
        const openModal2 = document.getElementById('openModal2')
        const closeModal = document.getElementById('closeModal')

        const emailForm = document.getElementById('email')
        const submitButton = document.getElementById('submit')

        function enableSubmit() {
          submitButton.removeAttribute('disabled')
        }

        openModal.onclick = function() {
            modal.style.display = 'block'

            setTimeout(function() {
              emailForm.focus()
            }, 66)
        }

        openModal2.onclick = function() {
            modal.style.display = 'block'

            setTimeout(function() {
              emailForm.focus()
            }, 66)
        }

        closeModal.onclick = function() {
          modal.style.display = 'none'
        }

        document.onclick = function () {
          if (event.target === modal) {
            modal.style.display = 'none'
          }
        }

        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' || e.keyCode === 27) {
            modal.style.display = 'none'
          }
        })

        submitButton.onclick = function() {
          if (!emailForm.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
            window.alert("email doesnt seem valid")

            return
          }

          const form = new FormData()

          form.append('payload', emailForm.value)

          fetch('https://flo.edgy0.workers.dev/', {
            method: 'POST',
            body: form
          })
          .then(res => res.text())
          .then(text => {
            window.alert(text)

            modal.style.display = 'none'
            emailForm.value = ''
          })
          .catch(err => {
            window.alert("Something went wrong ", err.message)
          })
        }
        </script>
    </main>

    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js"></script>
  </body>
</html>
